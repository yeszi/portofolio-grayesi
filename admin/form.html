<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pesan Masuk - Admin YesZie</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- TEMA WARNA PINK/PUTIH --- */
        :root {
            --primary-bg: #f8f9fa; /* Light Gray */
            --secondary-bg: #ffffff; /* White */
            --accent-color: #e91e63; /* Pink */
            --purple-accent: #f06292; /* Lighter Pink */
            --text-color: #212529; /* Dark Gray */
            --text-muted: #6c757d; /* Medium Gray */
            --input-bg: #e9ecef; /* Lighter input background */
            --button-primary: #e91e63; /* Pink */
            --button-hover-primary: #c2185b; /* Darker Pink */
            --button-logout: #dc3545; /* Red */
            --button-hover-logout: #c82333; /* Darker Red */
            --success-color: #28a745; /* Green */
            --error-color: #e74c3c; /* Red */
            --transition-speed: 0.3s;
            --border-color: #dee2e6; /* Light Gray Border */
            --sidebar-width: 260px;
        }

        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            background-color: var(--primary-bg);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.6;
            display: flex;
        }

        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--secondary-bg); /* Sidebar putih */
            border-right: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: transform var(--transition-speed) ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05); /* Shadow halus */
        }

        .sidebar-header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color); /* Logo pink */
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
         .sidebar-header .logo i { color: var(--accent-color); } /* Icon logo pink */


        #sidebar-close {
            display: none;
            background: none;
            border: none;
            color: var(--text-color); /* Tombol close warna teks */
            font-size: 1.5rem;
            cursor: pointer;
        }

        nav.sidebar-nav {
            flex-grow: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }

        nav.sidebar-nav a {
            color: var(--text-muted); /* Link abu-abu */
            margin: 0.25rem 0;
            text-decoration: none;
            font-weight: 500;
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        nav.sidebar-nav a i {
            font-size: 0.9rem;
            width: 20px;
            text-align: center;
        }

        nav.sidebar-nav a:hover {
            background-color: var(--input-bg); /* Hover abu muda */
            color: var(--text-color); /* Teks jadi gelap */
            transform: translateX(5px);
        }

        nav.sidebar-nav a.active {
            background-color: var(--accent-color); /* Background pink */
            color: #fff; /* Teks putih */
            transform: none;
            box-shadow: 0 4px 10px rgba(233, 30, 99, 0.3); /* Shadow pink */
        }
         nav.sidebar-nav a.active i { color: #fff; } /* Icon putih saat aktif */


        nav.sidebar-nav a#logoutLink {
            margin-top: auto;
            color: var(--button-logout); /* Warna merah */
        }
        nav.sidebar-nav a#logoutLink:hover {
            background-color: var(--button-logout);
            color: var(--white-color); /* Teks putih */
            transform: translateX(5px);
        }

        .main-content {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .mobile-header {
            display: none;
            background-color: var(--secondary-bg); /* Header putih */
            padding: 1rem 1.5rem;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Shadow lebih halus */
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }

        #hamburger-open {
            background: none;
            border: none;
            color: var(--text-color); /* Icon warna teks */
            font-size: 1.5rem;
            cursor: pointer;
        }

        .container {
            flex-grow: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Styling Judul Halaman Utama */
        .page-header {
             background: var(--secondary-bg);
             padding: 1.5rem 2rem;
             border-radius: 8px;
             margin-bottom: 2rem;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        .page-header h1 {
             font-size: 1.8rem;
             font-weight: 600;
             color: var(--text-color);
             display: flex;
             align-items: center;
             gap: 10px;
        }
         .page-header h1 i { color: var(--accent-color); } /* Icon judul pink */

        /* Message Items */
        .message-container {
            background: var(--secondary-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .message-container h2 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            color: var(--accent-color); /* Judul pink */
            font-size: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-color); /* Garis bawah pink */
            justify-content: center; /* Rata tengah */
        }

        .message-container h2 i {
            margin-right: 10px;
        }

        .message-list {
            display: grid;
            gap: 15px;
        }

        .message-item {
            background: var(--input-bg); /* Background abu muda */
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color); /* Border kiri pink */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
             box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .message-item:hover {
            transform: translateY(-2px);
             box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }

        .message-item p {
            margin-bottom: 8px;
            line-height: 1.6;
            color: var(--text-color); /* Warna teks utama */
        }

        .message-item strong {
            color: var(--accent-color); /* Label pink */
            font-weight: 600; /* Sedikit lebih tebal */
        }

        .message-meta {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Ratakan vertikal */
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--text-muted); /* Warna abu-abu */
            border-top: 1px dashed var(--border-color); /* Garis pemisah */
            padding-top: 10px;
        }

        /* Tombol Delete */
        .btn-delete {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--button-logout); /* Warna merah */
            color: white;
            margin-left: auto; /* Dorong ke kanan dalam .message-meta */
        }

        .btn-delete i {
            margin-right: 5px;
        }

        .btn-delete:hover {
            background-color: var(--button-hover-logout);
             transform: scale(1.05);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            background-color: var(--input-bg); /* Background abu */
            border-radius: 8px;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent-color); /* Icon pink */
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Footer */
        footer {
            background-color: var(--secondary-bg); /* Footer putih */
            color: var(--text-muted); /* Teks abu-abu */
            text-align: center;
            padding: 20px;
            margin-top: auto; /* Dorong ke bawah */
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        /* Overlay for mobile */
        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.4); /* Overlay sedikit lebih terang */
            z-index: 900;
            display: none;
            opacity: 0; /* Mulai transparan */
            transition: opacity var(--transition-speed) ease;
        }
        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* --- RESPONSIVE CSS --- */
        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(-100%);
                z-index: 2000;
                box-shadow: 5px 0 15px rgba(0,0,0,0.1); /* Shadow saat terbuka */
            }
            #sidebar.open { /* Ganti .active jadi .open agar konsisten dgn JS */
                transform: translateX(0);
            }
            #sidebar-close {
                display: block;
            }
            .main-content {
                margin-left: 0;
            }
            .mobile-header {
                display: flex; /* Tampilkan header mobile */
            }
            .container {
                padding: 1rem;
            }
            .page-header {
                 margin: 1rem; /* Margin di mobile */
                 padding: 1rem 1.5rem;
            }
            .page-header h1 { font-size: 1.4rem; }

            .message-container { padding: 1.5rem; }
            .message-item { padding: 1.5rem; }
            .message-meta { flex-direction: column; align-items: flex-start; gap: 8px;}
            .btn-delete { align-self: flex-start; } /* Tombol delete rata kiri */

            footer { padding: 15px; }
        }

        @media (max-width: 480px) {
            .sidebar-header .logo { font-size: 1.3rem; }
            .page-header h1 { font-size: 1.2rem; }
             h2 { font-size: 1.3rem; }
             .message-item strong { display: block; margin-bottom: 2px;} /* Label jadi block */
        }
    </style>
</head>
<body>
<div class="main-container">

    <header class="mobile-header">
        <button id="hamburger-open">
            <i class="fas fa-bars"></i>
        </button>
        <h1 style="margin-left: 1rem; font-size: 1.2rem; color: var(--accent-color);">Pesan Masuk</h1>
    </header>

    <div id="sidebar-overlay"></div>

    <aside id="sidebar">
        <div class="sidebar-header">
            <a href="admin_dashboard.html" class="logo">
                <i class="fas fa-user-shield"></i> YesZie
            </a>
            <button id="sidebar-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="admin_dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="edit.html"><i class="fas fa-edit"></i> Edit Content</a>
            <a href="tambah.html"><i class="fas fa-plus-circle"></i> Add Content</a>
            <a href="form.html" class="active"><i class="fas fa-envelope"></i> Form Messages</a> <a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Log Out</a>
        </nav>
    </aside>

    <div class="main-content" id="mainContent">

        <div class="page-header">
            <h1><i class="fas fa-inbox"></i> Pesan Masuk</h1>
        </div>

        <div class="container">
            <div class="message-container">
                <h2><i class="fas fa-envelope-open-text"></i> Daftar Pesan</h2>
                <div class="message-list" id="contact-messages">
                    <div class="empty-state" id="loading-state"> <i class="fas fa-spinner fa-spin"></i>
                        <p>Memuat pesan...</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 YesZie Admin Panel | All Rights Reserved</p>
        </footer>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        /* --- LOGIKA SIDEBAR (COPY DARI edit.html) --- */
        const sidebar = document.getElementById('sidebar');
        const openBtn = document.getElementById('hamburger-open');
        const closeBtn = document.getElementById('sidebar-close');
        const overlay = document.getElementById('sidebar-overlay');
        const mainContent = document.getElementById('mainContent'); // Tambahkan ini

        function openSidebar() {
            if(sidebar) sidebar.classList.add('open');
            if(overlay) overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
            if(sidebar) sidebar.classList.remove('open');
            if(overlay) overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        if (openBtn) openBtn.addEventListener('click', openSidebar);
        if (closeBtn) closeBtn.addEventListener('click', closeSidebar);
        if (overlay) overlay.addEventListener('click', closeSidebar);

        // Tutup sidebar saat link di klik (mobile)
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
             link.addEventListener('click', (e) => {
                 // Jangan tutup jika itu link logout
                 if(link.id === 'logoutLink') return;
                 if (window.innerWidth <= 768 && sidebar.classList.contains('open')) {
                     closeSidebar();
                 }
             });
        });


        /* --- LOGIKA HALAMAN PESAN MASUK --- */
        const SUPABASE_URL = 'https://owqdtbzhnxbxdsjrlzsa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93cWR0YnpobnhieGRzanJsenNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NzA1MjMsImV4cCI6MjA2NjQ0NjUyM30.cNmvpc_pBV89o9GHMU2CL0bSdgkdavAZuxB_w0Gv4gA';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Cek sesi login
        async function checkAdmin() {
            try {
                 const { data: { session } } = await supabaseClient.auth.getSession();
                 if (!session || session.user.email !== "grayesi.silitonga@gmail.com") {
                     showNotification('error', "❌ Akses ditolak. Login sebagai admin.");
                     setTimeout(() => window.location.href = "login.html", 2000);
                 } else {
                     console.log("✅ Admin logged in:", session.user.email);
                     fetchContactMessages(); // Muat pesan jika admin
                 }
            } catch (err) {
                 console.error("Error checking session:", err);
                 showNotification('error', "Terjadi kesalahan saat cek sesi.");
                 setTimeout(() => window.location.href = "login.html", 2000);
            }
        }

        // Logout handler
        const logoutButton = document.getElementById('logoutLink');
        if (logoutButton) {
            logoutButton.addEventListener('click', async (e) => {
                e.preventDefault();
                 const { error } = await supabaseClient.auth.signOut();
                 if (error) {
                     showNotification('error', 'Gagal logout: ' + error.message);
                 } else {
                     showNotification('success', 'Berhasil logout...');
                     setTimeout(() => window.location.href = "login.html", 1500);
                 }
            });
        }

        // Delete message function (dibuat global)
        window.deleteMessage = async function(id) {
            if (!confirm("Anda yakin ingin menghapus pesan ini?")) return;
            const { error } = await supabaseClient
                .from('contact_messages')
                .delete()
                .eq('id', id);

            if (error) {
                 showNotification('error', 'Gagal menghapus pesan: ' + error.message);
                 console.error("Delete error:", error);
            } else {
                 showNotification('success', '🗑️ Pesan berhasil dihapus!');
                 // Optimistic UI: Hapus langsung dari DOM sebelum fetch ulang
                 const itemToRemove = document.getElementById(`msg-${id}`);
                 if (itemToRemove) itemToRemove.remove();
                 // Optional: Panggil fetchContactMessages() lagi jika perlu sinkronisasi penuh
                 // fetchContactMessages();
            }
        }

        // Fetch contact messages
        async function fetchContactMessages() {
            const container = document.getElementById('contact-messages');
            const loadingState = document.getElementById('loading-state');

            // Tampilkan loading HANYA jika container kosong
            if (!container.querySelector('.message-item')) {
                 if(loadingState) loadingState.style.display = ''; // Tampilkan loading
                 else container.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Memuat pesan...</p></div>';
            }


            const { data, error } = await supabaseClient
                .from('contact_messages')
                .select('*')
                .order('created_at', { ascending: false });

            // Sembunyikan loading setelah fetch selesai (walaupun error)
             if(loadingState) loadingState.style.display = 'none';

            if (error) {
                 console.error("Fetch error:", error);
                 container.innerHTML = `
                     <div class="empty-state">
                         <i class="fas fa-exclamation-triangle"></i>
                         <p>Gagal memuat pesan. Coba refresh halaman.</p>
                     </div>
                 `;
                 return;
            }

            if (!data || data.length === 0) {
                 container.innerHTML = `
                     <div class="empty-state">
                         <i class="far fa-folder-open"></i>
                         <p>Belum ada pesan masuk.</p>
                     </div>
                 `;
                 return;
            }

            container.innerHTML = ''; // Kosongkan container sebelum mengisi
            data.forEach(msg => {
                 const msgDate = new Date(msg.created_at);
                 const formattedDate = msgDate.toLocaleString('id-ID', {
                     day: 'numeric', month: 'long', year: 'numeric',
                     hour: '2-digit', minute: '2-digit'
                 });

                 const msgBox = document.createElement('div');
                 msgBox.classList.add('message-item');
                 msgBox.id = `msg-${msg.id}`; // Beri ID unik untuk delete
                 msgBox.innerHTML = `
                     <p><strong>Nama:</strong> ${sanitizeInput(msg.name)}</p>
                     <p><strong>Email:</strong> ${sanitizeInput(msg.email)}</p>
                     <p><strong>Pesan:</strong><br>${sanitizeInput(msg.message).replace(/\n/g, '<br>')}</p>
                     <div class="message-meta">
                         <span><i class="far fa-clock"></i> ${formattedDate}</span>
                         <button class="btn-delete" onclick="deleteMessage('${msg.id}')">
                             <i class="fas fa-trash"></i> Hapus
                         </button>
                     </div>
                 `;
                 container.appendChild(msgBox);
            });
        }

         // Fungsi sanitasi (penting!)
         function sanitizeInput(str) {
             if (!str) return '';
             const temp = document.createElement('div');
             temp.textContent = str;
             return temp.innerHTML;
         }

        // Notification function (bisa disesuaikan)
        function showNotification(type, message) {
            const notification = document.createElement('div');
            // Style notifikasi (bisa dibuat lebih bagus)
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '5px';
            notification.style.color = 'white';
            notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            notification.style.zIndex = '2000';
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.3s ease';
            notification.style.display = 'flex';
            notification.style.alignItems = 'center';
            notification.style.gap = '10px';

            notification.style.background = (type === 'success') ? 'var(--success-color)' : 'var(--error-color)';
            notification.innerHTML = `
                 <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                 <span>${message}</span>
            `;

            document.body.appendChild(notification);
             // Animate in
            setTimeout(() => notification.style.opacity = '1', 50);

            // Animate out and remove
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000); // Tampil selama 3 detik
        }


        // Realtime updates
        supabaseClient
            .channel('realtime_contact_messages')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'contact_messages' }, payload => {
                 console.log("📩 Perubahan Realtime Pesan:", payload);
                 showNotification('success', 'Ada pesan baru atau perubahan!');
                 fetchContactMessages(); // Muat ulang daftar pesan
            })
            .subscribe((status) => {
                 if (status === 'SUBSCRIBED') {
                     console.log('👂 Berhasil subscribe ke perubahan pesan.');
                 } else {
                     console.warn('⚠️ Gagal subscribe atau status:', status);
                 }
             });

        // Initialize
        checkAdmin(); // Cek admin dulu, baru fetch

    }); // Penutup DOMContentLoaded
</script>
</body>
</html>